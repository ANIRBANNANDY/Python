import queue
import sounddevice as sd
import vosk
import json

# Set up the model (Replace 'path/to/model' with your actual model folder)
model = vosk.Model("path/to/vosk-model-small-en-us-0.15")
q = queue.Queue()

def callback(indata, frames, time, status):
    if status:
        print(status)
    q.put(bytes(indata))  # Add audio data to queue

# Set up microphone stream
with sd.RawInputStream(samplerate=16000, blocksize=8000, device=None,
                        dtype="int16", channels=1, callback=callback):
    print("Listening... Press Ctrl+C to stop")
    
    recognizer = vosk.KaldiRecognizer(model, 16000)
    
    while True:
        try:
            data = q.get()
            if recognizer.AcceptWaveform(data):
                result = json.loads(recognizer.Result())
                print("Vosk:", result["text"])
        except KeyboardInterrupt:
            print("\nStopping transcription...")
            break
