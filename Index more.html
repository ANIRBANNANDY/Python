async function pushFile(fileName, event) {
    const btn = event.currentTarget;
    const originalContent = btn.innerHTML;
    
    // Set "Busy" State
    btn.disabled = true;
    btn.classList.replace('btn-success', 'btn-warning');
    btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';

    // FILTER: Only pick servers that match 'd' followed by a number (e.g., d4, d5, d9)
    // Adjust the regex if your naming is strictly 'd' + single digit
    const targetServers = config.servers.filter(srv => /d\d/.test(srv));
    
    let targetIp = null;

    try {
        for (const ip of targetServers) {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 1500);

                const check = await fetch(`http://${ip}:${config.agent_port}/check-ready`, { 
                    signal: controller.signal 
                });
                const status = await check.json();
                clearTimeout(timeoutId);

                if (status.ready) {
                    targetIp = ip;
                    break; 
                }
            } catch (e) {
                console.warn(`Skipping ${ip}: Not ready or unreachable.`);
            }
        }

        if (!targetIp) {
            alert("No 'd*' server is free. All target folders are full.");
        } else {
            const res = await fetch(`http://${targetIp}:${config.agent_port}/receive-push`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ filename: fileName })
            });
            const result = await res.json();
            
            if (result.success) {
                alert(`Pushed successfully to ${targetIp}`);
                updateQueue(); 
            }
        }
    } catch (err) {
        alert("Push failed due to a network error.");
    } finally {
        if (btn) {
            btn.disabled = false;
            btn.classList.replace('btn-warning', 'btn-success');
            btn.innerHTML = originalContent;
        }
    }
}
